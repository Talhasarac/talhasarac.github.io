(function(){"use strict";const L=new Map,i=document.getElementById("js-hover"),H=".app";let b=null,a=null,m=null,h=null,w=null,U=!0;const u=document.querySelector("#js-screenshots"),P=document.body.dataset.steamCdn,C=new Image;C.fetchpriority="low";let l=null,T=0,d=0;window.SteamDB.RequirePageScreenshotViewer(K,!0),Z(),i.parentNode.addEventListener("click",z),i.addEventListener("pointerenter",ne,{passive:!0}),i.addEventListener("pointerleave",oe,{passive:!0}),document.body.addEventListener("touchstart",J,{passive:!0}),window.SteamDB.BindHover=e=>F(e.querySelectorAll(H)),window.SteamDB.HideHoverIfAny=f,window.SteamDB.OnExtensionUserdataLoaded(()=>{U=!1});function z(e){e.target.className==="hover_mobile"&&f()}let D=null,x=null,g=null;function J(e){const t=e.target.closest(".app");if(!t||e.touches.length!==1)return;const n=N(t);n!==null&&n.scrollLeft!==0||(g=t,D=x=e.touches.item(0),document.body.addEventListener("touchmove",j,{passive:!0}),document.body.addEventListener("touchend",k,{passive:!0}))}function j(e){const t=e.touches.item(0),n=t.screenX-D.screenX,o=t.screenY-D.screenY;if(t.screenX<x.screenX||Math.abs(o/n)>=.3){g=null,k();return}x=t}function k(){if(document.body.removeEventListener("touchmove",j),document.body.removeEventListener("touchend",k),g!==null&&x.screenX-D.screenX>100){const e="app",t=+g.dataset.appid;let n;if(e==="app"&&(n=L.get(t)),n)return i.appendChild(n),A(n,null);Q(e,t,null)}g=null}function N(e,t){return e===null||t>8?null:e.scrollWidth>e.clientWidth?e:N(e.parentNode,t+1)}function Z(){const e=typeof $=="function"&&typeof $.fn=="object"&&typeof $.fn.dataTable=="function";let t=e?[]:document.querySelectorAll(H);e&&$($.fn.dataTable.tables()).each(function(){t=$(this).DataTable().table().rows(H).nodes().reduce(function(o,r){return o.push(r),o},t),$(this).on("draw.dt",f)}),F(t)}function F(e){for(const t of e)t.addEventListener("pointerenter",Y,{passive:!0}),t.addEventListener("pointerleave",ee,{passive:!0})}function Y(e){if(e.pointerType!=="mouse"||window.matchMedia("(max-width: 980px)").matches)return;if(a){m=e;return}const t="app",n=+e.target.dataset.appid;let o;if(t==="app"&&(o=L.get(n)),o)return i.appendChild(o),A(o,e.target);f(),b=setTimeout(()=>{Q(t,n,e.target)},175)}function Q(e,t,n){let o;e==="app"&&(o=`/api/RenderAppHover/?appid=${t}`),h=new AbortController,fetch(o,{headers:{Accept:"text/html","X-Requested-With":"XMLHttpRequest"},signal:h.signal}).then(r=>{if(!r.ok){const s=new Error(`HTTP ${r.status}`);throw s.name="ServerError",s}return r.text()}).then(r=>{h=null,i.insertAdjacentHTML("beforeend",r);const s=i.firstChild;if(s){if(e==="app"){L.set(t,s),re(t,s);const c=s.querySelector(".js-open-screenshot-viewer");if(c&&c.dataset.screenshots){const S=c.dataset.screenshots.split(","),_=s.querySelector(".hover_title").textContent;K(c.dataset.appid,_,c,S)}}A(s,n)}}).catch(r=>{if(!(r.name==="AbortError"||r.name==="ServerError"))throw r})}function f(){if(m=null,b&&(clearTimeout(b),b=null),a&&(clearTimeout(a),a=null),h&&(h.abort(),h=null),w){i.hidden=!0,i.parentNode.classList.remove("hover_mobile");const e=w.querySelector("video");e&&(e.src="",e.remove()),w.remove(),w=null}}function ee(e){e.pointerType==="mouse"&&(m=null,!a&&(i.contains(e.relatedTarget)||(a=setTimeout(te,100))))}function te(){const e=m;f(),e&&Y(e)}function ne(){clearTimeout(a),a=null,m=null}function oe(e){e.pointerType==="mouse"&&f()}function A(e,t){const n=e.querySelector(".hover_video");if(n){const E=document.createElement("video");E.autoplay=!0,E.muted=!0,E.loop=!0,E.src=n.dataset.src,n.appendChild(E)}if(w=e,i.hidden=!1,t===null){i.parentNode.classList.add("hover_mobile");return}const o=t.getBoundingClientRect(),r=document.documentElement.scrollTop,s=o.top+r,c=o.bottom+r,S=o.left+document.documentElement.scrollLeft,_=document.documentElement.clientWidth,R=document.documentElement.clientHeight,X=i.offsetWidth,y=i.offsetHeight,se=_-(S+o.width+X),M=S-X;let v=0;M<0&&se<0?(i.style.left=o.right-X+"px",s+y>R+r&&s-y>=r?v=s-y:v=c):(M<0?i.style.left=S+o.width+"px":i.style.left=M+"px",s+y>R+r?v=R+r-y:v=s),v<1?i.style.top=0:i.style.top=v+"px"}function p(e){d+=e,d<0?d=l.length-1:d%=l.length;let t=l[d];if(t.startsWith("https://")||(t=`${P}steam/apps/${T}/${t}`),u.querySelector(".screenshot-contain").style.backgroundImage=`url(${encodeURI(t)})`,u.querySelector(".screenshot-index").textContent=`${d+1} of ${l.length}`,u.querySelector(".screenshot-open").href=t,l.length>1){e===0&&(e=1);let n=d+e;n<0?n=l.length-1:n%=l.length,t=l[n],t.startsWith("https://")||(t=`${P}steam/apps/${T}/${t}`),C.src=t}}function V(e){e.key==="ArrowLeft"?(e.preventDefault(),p(-1)):e.key==="ArrowRight"||e.key===" "?(e.preventDefault(),p(1)):e.key==="Escape"&&(e.preventDefault(),G())}function G(){document.documentElement.classList.remove("js-screenshots-shown"),document.removeEventListener("keydown",V),l=null,C.src="/static/p.gif"}u.querySelector(".screenshot-prev").addEventListener("click",e=>{e.preventDefault(),p(-1)}),u.querySelector(".screenshot-next").addEventListener("click",e=>{e.preventDefault(),p(1)}),u.querySelector(".screenshot-close").addEventListener("click",e=>{e.preventDefault(),G()}),u.querySelector(".screenshot-contain").addEventListener("click",e=>{e.preventDefault(),p(e.pageX/document.documentElement.clientWidth>=.5?1:-1)});function K(e,t,n,o){const r=s=>{const c=u.querySelector(".screenshot-name");c.textContent=`SteamDB \u2014 ${t}`,c.href=`/app/${e}/`,d=s,T=e,l=o,p(0),document.documentElement.classList.add("js-screenshots-shown"),document.addEventListener("keydown",V)};return n&&n.addEventListener("click",s=>{s.preventDefault(),r(0),f()}),{open:r}}function re(e,t){if(U)return;const n=t.querySelector(".hover_wishlist"),o=t.querySelector(".hover_follow"),r=t.querySelector(".hover_ignore");window.SteamDB.OwnedApps.has(e)?t.querySelector(".hover_owned").hidden=!1:n&&(window.SteamDB.WishedApps.has(e)&&W(n,!0),n.hidden=!1,n.addEventListener("click",s=>{s.preventDefault(),B(n),q(e,window.SteamDB.WishedApps.has(e)?"StoreWishlistRemove":"StoreWishlistAdd")})),o&&(window.SteamDB.FollowedApps.has(e)&&O(o,!0),o.hidden=!1,o.addEventListener("click",s=>{s.preventDefault(),B(o),q(e,window.SteamDB.FollowedApps.has(e)?"StoreUnfollow":"StoreFollow")})),r&&(window.SteamDB.IgnoredApps.has(e)&&I(r,!0),r.hidden=!1,r.addEventListener("click",s=>{s.preventDefault(),B(r),q(e,window.SteamDB.IgnoredApps.has(e)?"StoreUnignore":"StoreIgnore")}))}function B(e){e.innerHTML='<span class="loader"></span>'}function q(e,t){window.postMessage({type:"steamdb:extension-query",contentScriptQuery:t,appid:e},window.location.origin)}function W(e,t){e&&(e.classList.toggle("wished",t),e.textContent=t?"On Wishlist":"Wishlist")}function O(e,t){e&&(e.classList.toggle("followed",t),e.textContent=t?"Unfollow":"Follow")}function I(e,t){e&&(e.classList.toggle("ignored",t),e.textContent=t?"Unignore":"Ignore")}if("BroadcastChannel"in window)try{new BroadcastChannel("steamdb-extension").addEventListener("message",t=>{if(!(!t||t.origin!==window.location.origin)&&t.data&&t.data.type==="steamdb:extension-response"){if(!t.data.response||!t.data.response.success||!t.data.request.appid)return;const n=L.get(t.data.request.appid);if(!n)return;const o=n.querySelector(".hover_wishlist"),r=n.querySelector(".hover_follow"),s=n.querySelector(".hover_ignore");switch(t.data.request.contentScriptQuery){case"StoreWishlistAdd":W(o,!0);break;case"StoreWishlistRemove":W(o,!1);break;case"StoreFollow":O(r,!0);break;case"StoreUnfollow":O(r,!1);break;case"StoreIgnore":I(s,!0);break;case"StoreUnignore":I(s,!1);break}}})}catch{}})();
